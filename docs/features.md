# 機能仕様書

## 機能候補

### ✅ MVP リリース時に必要な機能

- **Bot 連携**
  - 「旅行プランを作成」などのトリガー入力
  - Flex Message で LIFF 起動ボタンを返す
  - 簡単な Yes/No や確認用の操作

- **LIFF アプリ**
  - 日程入力フォーム（カレンダー UI）
  - エリア選択（地方 → 都道府県レベル）
  - スポット選択
    - Google Maps API による有名スポットのレコメンド
    - チェックボックス形式で選択
    - LINE トークで入力されたスポット名や URL を追加可能
  - 地図表示
    - 選択スポットをピン表示
    - 日毎のルートを軽く描画

- **サーバー処理**
  - 旅程表の自動作成（スポット順序の最適化、日ごとのプラン生成）
  - プラン保存（DB に格納）
  - Bot 経由で完了通知を返す

### 🔜 将来的に追加したい機能

- ホテルや駅をスタート／ゴール地点に設定可能
- 移動時間の詳細表示
  - MVP：徒歩モードのみ（UI 非表示で裏側処理）
  - 拡張：電車・車モードに対応
- リマインダー通知（旅行前日に Bot から自動通知）
- 複数人での分担編集（グループ全員が同じプランを共同編集可能）
- 詳細な旅程分析やおすすめルート提案

## 🚀 MVP 以降に実装予定の機能詳細

### **スタート／ゴール地点設定**

- ホテルや駅・空港をプランのスタート／ゴール地点として設定可能にする
- 例：2 日目はホテルから出発、最終日は空港で終了

### **移動モードの拡張**

- MVP：徒歩モードのみ（UI には非表示、裏側で処理）
- 拡張：電車・車など複数の移動手段をサポート
- 移動時間の比較や最適ルート提示

### **通知・リマインダー**

- 旅行前日などに Bot からリマインド通知を送信
- 出発時刻やチェックイン時刻のアラート

### **複数人での共同編集**

- グループメンバー全員が同じプランを編集可能
- LINE グループに紐づいた共同編集モード

### **旅程表の高度化**

- 詳細な旅程分析（移動時間合計、滞在時間の自動計算など）
- ユーザーの嗜好や過去の旅行データをもとにおすすめルート提案

## 🤖 AI機能（プレミアムプラン限定）

プレミアムプランでは、生成AIを活用した高度な旅行プランニング支援機能を提供します。

### **実装優先順位**

#### Phase 1: 有料プラン導入時（必須）

##### 1. AI旅程アドバイザー

**概要:**
ルート生成時に、AIが最適な訪問順序と詳しい理由を説明します。

**主な機能:**

- 最適な訪問順序の提案（時刻付き）
- 推奨理由の詳細説明
  - 営業時間の考慮
  - 混雑状況の予測
  - 移動効率の分析
- 複数の代替案提示
  - 移動時間優先ルート
  - 体験重視ルート
  - バランス型ルート

**ユーザー体験例:**

```
📍 東京2泊3日プラン

【AIのおすすめルート】
1日目（土曜日）
09:00 浅草寺
↓ 徒歩15分
10:30 スカイツリー
↓ 電車20分
13:00 築地市場（ランチ）

💡 AIからのアドバイス:
「土曜の浅草寺は朝早めが空いています。スカイツリーは
午前中の方が空気が澄んで展望が良く、築地市場は13時頃が
混雑のピークを過ぎておすすめです。」

🔄 別の順序も提案
・移動時間優先ルート（20分短縮）
・体験重視ルート（滞在時間+30分）
```

**技術仕様:**

- 使用モデル: GPT-4o Mini / GPT-4o
- 入力情報:
  - スポット情報（営業時間、平均滞在時間、混雑傾向）
  - 旅行情報（日程、移動手段、ユーザー優先事項）
- 出力情報:
  - 最適化された訪問順序
  - 推奨訪問時刻
  - 理由説明
  - 代替案（2〜3パターン）

**想定コスト:** 1プランあたり約¥0.05

---

#### Phase 2: 成長期（3〜6ヶ月後）

##### 2. 旅程自動調整アシスタント

**概要:**
スポット追加・削除時に、AIがリアルタイムで旅程を再調整します。

**主な機能:**

- スポット追加時の自動スケジュール調整
- 移動時間の再計算と最適化
- 滞在時間の自動調整提案
- 関連スポットの提案（ランチ、休憩スポットなど）

**ユーザー体験例:**

```
【変更前】
09:00 浅草寺
11:00 スカイツリー
14:00 上野公園

↓ 「東京タワー」を追加

【AIからの提案】
🤖 東京タワーを追加すると、上野公園への移動時間が
   30分増えます。以下の変更をおすすめします:

【変更後】
09:00 浅草寺
11:00 スカイツリー
13:00 東京タワー（ランチも近くで）
15:30 上野公園

💡 スケジュール調整:
- 上野公園の滞在時間を90分→60分に短縮
- 東京タワー周辺のランチスポットも提案できます
```

**想定コスト:** 1調整あたり約¥0.04

##### 3. パーソナライズされたスポット提案

**概要:**
過去の旅行履歴から、ユーザーの好みに合ったスポットをAIが提案します。

**主な機能:**

- 過去の旅行データ分析
  - 訪問スポットのカテゴリー傾向
  - 混雑度の好み
  - 滞在時間の傾向
- 個人に最適化されたスポット推薦
- 推薦理由の説明

**ユーザー体験例:**

```
📍 京都のスポットを探す

🤖 あなたにおすすめ
これまでの旅行から、あなたは「歴史的建造物」と「静かな
カフェ」がお好きなようですね。

✨ おすすめスポット
・銀閣寺（歴史的建造物）
・哲学の道（散策）
・ブルーボトルコーヒー京都（カフェ）

📝 理由:
「清水寺や金閣寺も良いですが、あなたは混雑を避ける
傾向があるため、静かな銀閣寺周辺がおすすめです。」
```

**想定コスト:** 1検索あたり約¥0.03

---

#### Phase 3: 拡大期（6ヶ月〜1年後）

##### 4. 旅のコンシェルジュ（チャット形式）

**概要:**
旅行プラン作成中に、AIとチャットで相談できる機能です。

**主な機能:**

- 自然言語でのプラン相談
- リアルタイムな提案と調整
- 文脈を理解した会話
- プランへの直接反映

**ユーザー体験例:**

```
👤 ユーザー:
「2日目の午後、雨が降りそうなんだけど、
 室内で楽しめるスポットある?」

🤖 AI:
「雨の日なら、以下のスポットがおすすめです:

1. チームラボボーダレス（お台場）
   → 今のルートから電車20分
   → 所要時間: 2〜3時間

2. 国立科学博物館（上野）
   → 上野公園のすぐ近く
   → 所要時間: 1.5〜2時間

現在のプランだと、上野公園の後に国立科学博物館を
追加するのがスムーズですね。追加しますか?」

👤 ユーザー:
「追加して!」

🤖 AI:
「承知しました!14:30から国立科学博物館を追加しました。
 上野公園の滞在時間を少し短縮して調整しています。」
```

**想定コスト:** 1会話あたり約¥0.10

##### 5. 旅行後の振り返りレポート生成

**概要:**
旅行後に、AIが思い出をまとめたレポートを自動生成します。

**主な機能:**

- 旅行のハイライト抽出
- 統計情報の可視化
  - 総移動距離・時間
  - 訪問スポット数
  - お気に入りスポット
- ユーザーの好み分析
- 次回のおすすめ旅行先提案
- SNSシェア用画像生成

**ユーザー体験例:**

```
🎉 旅行お疲れ様でした!

━━━━━━━━━━━━━━━━━━
📊 東京2泊3日の旅 振り返り
━━━━━━━━━━━━━━━━━━

【訪問スポット】
✅ 9箇所訪問
⭐ お気に入り: スカイツリー（5.0）

【統計】
🚶 総移動距離: 12.5km
⏱️ 総移動時間: 3時間15分
📸 撮影スポット: 浅草寺、スカイツリー、東京タワー

【次回の旅行におすすめ】
あなたは「展望台」と「下町散策」がお好きなようですね。
次回は大阪（通天閣、新世界）や横浜（ランドマークタワー）
はいかがでしょうか?

📄 このレポートを画像で保存
```

**想定コスト:** 1レポートあたり約¥0.05

---

### **AI機能の技術仕様**

#### 使用モデル

- **GPT-4o Mini**: コストパフォーマンス重視（ほとんどの機能）
- **GPT-4o**: 高度な推論が必要な場合

#### API料金（2025年1月時点）

**GPT-4o Mini:**

- Input: $0.15/100万トークン（約¥22.5/100万トークン）
- Output: $0.60/100万トークン（約¥90/100万トークン）

**GPT-4o:**

- Input: $2.50/100万トークン（約¥375/100万トークン）
- Output: $10.00/100万トークン（約¥1,500/100万トークン）

#### 月間コスト見積もり（プレミアムユーザー20人想定）

| 機能                      | 1回あたり | 月間利用 | 月額コスト |
| ------------------------- | --------- | -------- | ---------- |
| 1. AI旅程アドバイザー     | ¥0.05     | 200回    | ¥10        |
| 2. 旅程自動調整           | ¥0.04     | 200回    | ¥8         |
| 3. スポット提案           | ¥0.03     | 200回    | ¥6         |
| 4. チャットコンシェルジュ | ¥0.10     | 100回    | ¥10        |
| 5. 振り返りレポート       | ¥0.05     | 20回     | ¥1         |
| **合計**                  | -         | -        | **¥35**    |

**安全マージン込み: ¥1,500〜¥3,000/月**

---

### **AI機能と従来機能の比較**

| 項目             | 無料/ベーシックプラン              | プレミアムプラン（AI）           |
| ---------------- | ---------------------------------- | -------------------------------- |
| **ルート最適化** | Google Directions API の自動最適化 | AI による高度な最適化 + 理由説明 |
| **考慮要素**     | 移動距離・時間のみ                 | 営業時間、混雑、ユーザー嗜好     |
| **代替案提示**   | なし                               | あり（2〜3パターン）             |
| **スポット提案** | エリア内の人気スポット             | パーソナライズされた提案         |
| **プラン調整**   | 手動                               | AIによる自動調整提案             |
| **相談機能**     | なし                               | AIチャットコンシェルジュ         |
| **振り返り**     | なし                               | AI生成レポート                   |

### **保存済みプランの強化**

- カード UI に「削除」や「複製」アイコンを追加
- 背景画像を固定イラストからユーザー投稿写真に差し替え

### **結果画面の拡張**

- マップタブで「全日程を同時に表示」できるモード
- スポットポップアップに説明文や営業時間などを追加

### **SNS 連携／シェア**

- 旅行プランを画像として出力し SNS でシェア
- QR コードで他のユーザーにプラン共有

## 機能とデータベースのマッピング

機能とDBテーブルの対応関係については、[DBスキーマ設計書](./database-schema.md#機能とテーブルのマッピング)を参照してください。
